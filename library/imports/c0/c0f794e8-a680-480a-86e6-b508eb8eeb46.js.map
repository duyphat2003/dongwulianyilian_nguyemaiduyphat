{"version":3,"sources":["assets\\framework\\plugin_boosts\\ui\\ViewManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import View from \"./View\";\r\nimport { Toast } from \"./ToastManager\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\nvar TAG:string = \"[ViewManager]\"\r\n@ccclass\r\nexport default class ViewManager extends cc.Component {\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    static instance:ViewManager;\r\n    // onLoad () {}\r\n\r\n    // baseDir:string = \"assets/\"\r\n\r\n    _views:{[index:string]:View} = {}\r\n\r\n// \r\n    @property(cc.Node)\r\n    modal:cc.Node = null;\r\n\r\n    @property\r\n    modalOpacity:number = 160;\r\n\r\n\r\n    onLoad()\r\n    {\r\n        ViewManager.instance = this;\r\n        this.modal.active = false;\r\n        this.modal.zIndex = 999;\r\n        g.setGlobalInstance(this);\r\n        // cc.game.addPersistRootNode(this.node);\r\n        // this.node.getComponent(cc.Widget).target = cc.find(\"Canvas\")\r\n    }\r\n\r\n    onEnable()\r\n    {\r\n        \r\n    }\r\n\r\n    onDestroy()\r\n    {\r\n        // cc.game.removePersistRootNode(this.node);\r\n        for(var key in this._views){\r\n            delete this._views[key];\r\n        }\r\n    }\r\n\r\n    start () {\r\n        //load prefab\r\n        \r\n        // this.modal.active = false;\r\n        // this.sprite = this.getComponent(cc.Sprite)\r\n        // this.modal.zIndex = 999;\r\n    }\r\n    private getVisibleDialog()\r\n    {\r\n        for(var name in this._views)\r\n        {\r\n            let view = this._views[name]\r\n            if(view.isDialog)\r\n            {\r\n                if (this.isVisible(name))\r\n                {\r\n                    return view;\r\n                }\r\n            }    \r\n        }\r\n        return null;\r\n    }\r\n\r\n    private hasVisibleDialog()\r\n    {\r\n        for(var name in this._views)\r\n        {\r\n            let view = this._views[name]\r\n            if(view.isDialog)\r\n            {\r\n                if (this.isVisible(name))\r\n                {\r\n                    return true\r\n                }\r\n            }    \r\n        }\r\n        return false;\r\n    }\r\n\r\n    public isVisible(viewname)\r\n    {\r\n        let view = null;\r\n        if (typeof(viewname) == \"string\")\r\n            view = this._views[viewname]\r\n        else\r\n            view = viewname;\r\n        //todo check type \r\n        if (view)\r\n        {\r\n            return view.node.active;\r\n        }\r\n        return false\r\n    }\r\n\r\n    private attachViewComp(existingView:cc.Node):View\r\n    {\r\n        let viewComp = null;\r\n        if(viewComp == null|| viewComp == undefined)\r\n        {\r\n            viewComp = existingView.getComponent(View);\r\n            if(viewComp == null)\r\n            {\r\n                viewComp = existingView.addComponent(View);\r\n                viewComp.init(existingView.name);\r\n            }\r\n            this._views[existingView.name] = viewComp;\r\n        }\r\n        return viewComp;\r\n    }\r\n\r\n    private showView(view,...params)\r\n    {\r\n        this.modal.active = view.isDialog;\r\n        //check has popuped dialog and  all currentview is dialog show modal forcely.\r\n        if (this.hasVisibleDialog() || view.isDialog)\r\n        {\r\n            this.modal.active =  true;            \r\n        }\r\n        if (view.isDialog)\r\n        {\r\n            this.modal.opacity = view.opacity;\r\n        }\r\n\r\n        // propagate params to dialog component\r\n        let comp = view.node.getComponent(view.node.name);\r\n        if (comp && comp.init) {\r\n            comp.init(params[0]); // pass first param object\r\n        }\r\n        return view.show(...params);\r\n    }\r\n\r\n    showFromPrefab(prefab:cc.Prefab,prefabPath:string ,...params)\r\n    {\r\n        let view = this._views[prefabPath];\r\n        if(view == null)\r\n        {\r\n            let node = cc.instantiate(prefab)\r\n            view = node.getComponent(View)\r\n            if(view == null)\r\n            {\r\n                view = node.addComponent(View);\r\n                view.isDialog = true;\r\n                //default is dialog\r\n            }\r\n            let widget = view.getComponent(cc.Widget);\r\n            if(widget)\r\n                widget.target = cc.find(\"Canvas\")\r\n            view.init(prefabPath);\r\n            this._views[prefabPath] = view;\r\n            if(view.isDialog)\r\n            {\r\n                this.node.addChild(node,1000);\r\n            }else{\r\n                this.node.addChild(node,1000);\r\n            }\r\n            // g.foreachNode(view.node,this.updateWidgets,this)\r\n        }\r\n        // node = view.node;\r\n        this.node.color.setA(255);\r\n        console.log(TAG,\"show view:\" + prefabPath )\r\n        return this.showView(view,...params);\r\n    }\r\n\r\n    showFromPrefabPath(prefabPath:string,...params)\r\n    {\r\n        let view = this._views[prefabPath]\r\n        if(view == null ||view == undefined)\r\n        {\r\n            console.log(\"start load prefab:\" +prefabPath)\r\n            let beforeTime = new Date().getTime();\r\n            cc.loader.loadRes(prefabPath,cc.Prefab,(e,prefab:cc.Prefab) =>{\r\n                console.log(TAG,\"prefab loaded : \"+ prefabPath +\" \"+  (new Date().getTime() - beforeTime) +\"ms\")\r\n                this.showFromPrefab(prefab,prefabPath,...params);\r\n            }) \r\n        }else{\r\n            // this.sprite.enabled = false;\r\n            this.modal.active = view.isDialog;\r\n            if (this.hasVisibleDialog() || view.isDialog)\r\n            {\r\n                this.modal.active =  true;     \r\n                this.modal.opacity = view.opacity;       \r\n            }\r\n            console.log(TAG,\"show view:\" + prefabPath ,params)\r\n            // let viewnode = view.node;\r\n            // view.node.x = 0;\r\n            // view.node.y = 0;\r\n            return  view.show(...params);\r\n        }\r\n    }\r\n\r\n    preload(prefabPath:string)\r\n    {\r\n        let view = this._views[prefabPath]\r\n        if(view == null ||view == undefined)\r\n        {\r\n            cc.loader.loadRes(prefabPath,cc.Prefab,(e,prefab:cc.Prefab) =>{\r\n                console.log(TAG,\"preload view\"+ prefabPath)\r\n                let node = cc.instantiate(prefab)\r\n                view = node.getComponent(View);\r\n                let widget = view.getComponent(cc.Widget);\r\n                if(widget)\r\n                    widget.target = cc.find(\"Canvas\")\r\n                view.init(prefabPath);\r\n                this._views[prefabPath] = view;\r\n                // this.scheduleOnce(_=>node.active = false,0);\r\n                if (view.isDialog)\r\n                {\r\n                    this.node.addChild(node,1000);\r\n                }else{\r\n                    this.node.addChild(node,1000);\r\n                }\r\n                view.hide();\r\n            }) \r\n        }else{\r\n        }\r\n    }\r\n\r\n    // will enableTouch next show up\r\n    disableTouch(viewNode)\r\n    {\r\n        let view = viewNode.getComponent(View)\r\n        if(view)\r\n        {\r\n            view.touchEnabled = false;\r\n        }\r\n    }\r\n\r\n    enableTouch(viewNode)\r\n    {\r\n        let view = viewNode.getComponent(View)\r\n        if(view)\r\n        {\r\n            view.touchEnabled = true;\r\n        }\r\n    }\r\n\r\n\r\n    show(view, ...params)\r\n    {\r\n        // disable current view 's touch  \r\n        if (typeof(view) == \"string\")\r\n        {\r\n            return this.showFromPrefabPath(view,...params);\r\n        }\r\n        else{\r\n            if (view == null|| view == undefined)  return;\r\n            if(view.node) view = view.node;\r\n            let v = this.attachViewComp(view)\r\n            return this.showView(v,...params);\r\n        }\r\n    }\r\n\r\n\r\n    hide(viewname,playHideAnim = true)\r\n    {\r\n        if(typeof(viewname) != \"string\")\r\n        {\r\n            // get view name \r\n            if (viewname == null|| viewname == undefined) return;\r\n            this.attachViewComp(viewname)\r\n            viewname = viewname.name;\r\n        }\r\n        let view = this._views[viewname]\r\n        if(view != null && view != undefined)\r\n        {\r\n            view.node.active = false;\r\n            if (view.isDialog ){\r\n                //todo: should support dialog hide animtion  later \r\n                this.modal.active = false;\r\n            }\r\n            if(this.hasVisibleDialog())\r\n            {\r\n                this.modal.active = true;\r\n            }\r\n            // if(view.isInHideAnimation())\r\n            //     return;\r\n            // view.hide();\r\n            if(playHideAnim )\r\n                view.doHideAnimation();\r\n            view.onHidden();\r\n        }\r\n    }\r\n\r\n    checkViewStacks()\r\n    {\r\n        let dialog = this.getVisibleDialog()\r\n        if(dialog)\r\n        {\r\n            this.modal.active = true;\r\n            this.modal.opacity = dialog.opacity;\r\n        }\r\n    }\r\n\r\n    hideAll()\r\n    {\r\n        for (var viewname in this._views){\r\n            // let view = this._views[viewname]\r\n            this.hide(viewname);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}