{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\PsSpawner.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PsFx from \"./PsFx\";\r\nimport PoolManager from \"./PoolManager\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PsSpawner extends cc.Component {\r\n\r\n    static instance:PsSpawner;\r\n    \r\n    poolmgr:PoolManager;\r\n    onLoad()\r\n    {\r\n        this.poolmgr = new PoolManager();\r\n    }\r\n\r\n    start () {\r\n\r\n    }\r\n\r\n    clear()\r\n    {\r\n        if(this.poolmgr)\r\n            this.poolmgr.clear();\r\n    }\r\n\r\n    getFx(prefabPath):Promise<PsFx>\r\n    {\r\n        return new Promise<PsFx>((resolve,reject)=>{\r\n            let node = this.poolmgr.get(prefabPath)\r\n            if(node == null)\r\n            {\r\n                if(prefabPath instanceof cc.Prefab )\r\n                {\r\n                    node = cc.instantiate(prefabPath);\r\n                    this.poolmgr.tag(node,prefabPath)\r\n                }else{\r\n                    cc.loader.loadRes(prefabPath,cc.Prefab,(e,prefab:cc.Prefab) =>{\r\n                        node = cc.instantiate(prefab);\r\n                        node.setParent(this.node);\r\n                        let psfx = node.getComponent(PsFx)\r\n                        psfx.name = prefabPath;\r\n                        resolve(psfx);\r\n                    }) \r\n                    return;\r\n                }\r\n            }\r\n            node.setParent(this.node);\r\n            node.active = false;\r\n            let psfx = node.getComponent(PsFx)\r\n            psfx.reset();\r\n            resolve(psfx);\r\n        })\r\n    }\r\n\r\n    onFxFinshPlay(fx:PsFx)\r\n    {\r\n        this.poolmgr.put(fx.node);\r\n    }\r\n\r\n    async play(prefabPath,pos = cc.Vec2.ZERO,rotation = 0,audio?,spriteframe?)\r\n    {\r\n        let fx = await this.getFx(prefabPath);\r\n        fx.node.position = pos;\r\n        fx.node.rotation = rotation;\r\n        await fx.play(audio,spriteframe)\r\n        this.onFxFinshPlay(fx);\r\n    }\r\n\r\n    async play2(prefabPath,pos = cc.Vec2.ZERO,rotation = 0,scale=0)\r\n    {\r\n        let fx = await this.getFx(prefabPath);\r\n        fx.node.position = pos;\r\n        fx.node.scale = scale;\r\n        fx.node.rotation = rotation;\r\n        await fx.play()\r\n        this.onFxFinshPlay(fx);\r\n    }\r\n\r\n    async play3(prefabPath,pos)\r\n    {\r\n        let fx = await this.getFx(prefabPath);\r\n        fx.node.position = pos;\r\n        fx.play().then(_=>this.onFxFinshPlay(fx));\r\n        return fx.node;\r\n    }\r\n\r\n\r\n    // update (dt) {}\r\n}\r\n"]}