{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\PsFxPlayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PsFx from \"./PsFx\";\r\nimport Device from \"./Device\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PsFxPlayer extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    prefab:cc.Prefab = null\r\n\r\n    _fx:PsFx = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    spriteFrame:cc.SpriteFrame = null\r\n\r\n    @property({type: cc.AudioClip})\r\n    audioClip:cc.AudioClip;\r\n\r\n    @property\r\n    duration:number = -1;\r\n\r\n    @property\r\n    randomRotaion: boolean = false;\r\n\r\n    start () {\r\n    }\r\n\r\n    get fx()\r\n    {\r\n        if(this._fx == null && this.prefab)\r\n        {\r\n            let node = cc.instantiate(this.prefab);\r\n            if(node == null) return null;\r\n            let fx = node.getComponent(PsFx)\r\n            if(fx == null)\r\n            {\r\n                fx = this.addComponent(PsFx);\r\n            }\r\n            node.setPosition(0,0);\r\n            node.setParent(this.node);\r\n            this._fx = fx;\r\n        }\r\n        return this._fx;\r\n    }\r\n\r\n    isPlaying()\r\n    {\r\n        return this.fx.isPlaying;\r\n    }\r\n\r\n    onEnable()\r\n    {\r\n        \r\n    }\r\n\r\n    onDisable()\r\n    {\r\n        let fx = this._fx;\r\n        if(fx)\r\n            fx.node.active = false;\r\n    }\r\n\r\n    sleep(sec){\r\n        return new Promise((resolve,reject)=>{\r\n            setTimeout(_=>{\r\n                resolve();\r\n            } , sec)\r\n        })\r\n    };\r\n\r\n    async play()\r\n    {\r\n        Device.playEffect(this.audioClip,false);\r\n        let fx = this.fx;\r\n        if(fx)\r\n        {\r\n            fx.node.active = true;\r\n            if(this.randomRotaion)\r\n                fx.node.rotation = g.randomInt(0,360);  \r\n            fx.reset();\r\n            return fx.play(this.audioClip,this.spriteFrame);\r\n        }else{\r\n            if(this.duration > 0 )\r\n                await this.sleep(this.duration * 1000);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}