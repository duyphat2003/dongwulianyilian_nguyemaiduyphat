{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\PoolManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nexport default class PoolManager\r\n{\r\n    nodePool:any = {}\r\n    \r\n    nodes = {}\r\n\r\n    onCreateObject:Function;\r\n    target:any;\r\n    root:cc.Node;\r\n\r\n    managed:boolean = false;\r\n    aliveObjects:cc.Node[] = []\r\n\r\n    constructor(root?:cc.Node,onCreateObject?,target?)\r\n    {\r\n        this.onCreateObject = onCreateObject;\r\n        this.target = target;\r\n        this.root = root;\r\n        if(root)\r\n        {\r\n            root.on(cc.Node.EventType.CHILD_REMOVED, this.onNodeRemove, this)\r\n        }\r\n    }\r\n\r\n    onNodeRemove(node)\r\n    {\r\n        this.put(node);\r\n    }\r\n\r\n    objects()\r\n    {\r\n        return this.aliveObjects;\r\n    }\r\n\r\n    clearAlives()\r\n    {\r\n        for (var i = 0; i< this.aliveObjects.length;)\r\n        {\r\n            let obj = this.aliveObjects[i]\r\n            obj.removeFromParent()\r\n        }\r\n    }\r\n\r\n    getPool(type):cc.NodePool\r\n    {\r\n        if(typeof(type) != \"string\" || typeof(type)!= \"number\" )\r\n        {\r\n            type = type._uuid || type.name;\r\n        }\r\n        let pool = this.nodePool[type];\r\n        if(pool == null)\r\n        {\r\n            pool = new cc.NodePool();\r\n            this.nodePool[type] = pool;\r\n        }\r\n        return pool;\r\n    }\r\n\r\n    get(type):cc.Node\r\n    {\r\n        let node =  this.getPool(type).get();\r\n        if(this.onCreateObject)\r\n        {\r\n            if(node == null)\r\n            {\r\n                node = this.onCreateObject.call(this.target,type)\r\n                if(this.root)\r\n                    node.setParent(this.root);\r\n                if(!node )\r\n                    console.warn(node,\"onCreateObject must return an object\")\r\n                if(this.managed)\r\n                    this.aliveObjects.push(node);\r\n                this.nodes[node.uuid] = type;\r\n                return node;\r\n            }\r\n        }\r\n        if(this.root)\r\n            node.setParent(this.root);\r\n        if(this.managed)\r\n            this.aliveObjects.push(node);\r\n        return node;\r\n    }\r\n\r\n    tag(node,type)\r\n    {\r\n        this.nodes[node.uuid] = type;\r\n    }\r\n\r\n    put(node:cc.Node,type = null)\r\n    {\r\n        if(type == null)\r\n            type = this.nodes[node.uuid];\r\n        this.getPool(type).put(node);\r\n        if(this.managed)\r\n            this.aliveObjects.splice(this.aliveObjects.indexOf(node),1);\r\n    }\r\n\r\n    clear(type?)\r\n    {\r\n        if(this.managed)\r\n            this.aliveObjects.splice(0,this.aliveObjects.length);\r\n        if(type)\r\n            this.getPool(type).clear();\r\n        else\r\n        {\r\n            for (var t in this.nodePool)\r\n            {\r\n                let pool = this.nodePool[t]\r\n                pool.clear();\r\n            }\r\n        }\r\n    }\r\n\r\n    size(type)\r\n    {\r\n        return this.getPool(type).size();\r\n    }\r\n}"]}