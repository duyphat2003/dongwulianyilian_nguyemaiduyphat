{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\InfiniteBackground.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class InfiniteBackground extends cc.Component {\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // onLoad () {}\r\n\r\n    @property(cc.Node)\r\n    bgNode:cc.Node = null;\r\n\r\n    @property(cc.Camera)\r\n    camera:cc.Camera= null;\r\n\r\n    next:cc.Node;\r\n    prev:cc.Node;\r\n    pre_prev :cc.Node;\r\n    currentNode:cc.Node = null;\r\n    repeatCount = 0;\r\n\r\n    size : cc.Size;\r\n\r\n    nodepool:cc.NodePool;\r\n    onLoad()\r\n    {\r\n        this.currentNode = this.bgNode;\r\n        this.size = this.currentNode.getContentSize();\r\n        this.nodepool = new cc.NodePool();\r\n    }\r\n\r\n    start () {\r\n        if(this.prev == null)\r\n        {\r\n            this.prev = cc.instantiate(this.bgNode);\r\n            this.node.addChild(this.prev);\r\n            this.prev.y =  - this.size.height;\r\n        }\r\n    }\r\n\r\n    reset()\r\n    {\r\n        this.repeatCount = 0;\r\n        //todo :remove all \r\n        //todo:init all\r\n    }\r\n    \r\n    update (dt) {\r\n\r\n        if(this.currentNode == null)return\r\n        let pos = cc.Vec2.ZERO;\r\n        this.camera.getWorldToCameraPoint(this.currentNode.position,pos)\r\n        let prev = this.prev;\r\n        if (pos.y < 10)\r\n        {\r\n            // check has next \r\n            if(this.next == null)\r\n            {\r\n                this.pre_prev = this.prev;\r\n                this.prev = this.currentNode;\r\n                let road = this.nodepool.get()\r\n                if(road == null)\r\n                    road = cc.instantiate(this.currentNode);\r\n                road.setPosition(0,this.size.height * ++this.repeatCount);\r\n                this.node.addChild(road);\r\n                this.currentNode = road;\r\n                this.camera.getWorldToCameraPoint(road.position,pos)\r\n                this.next = null;\r\n                // console.log(\"create new road\")\r\n            }\r\n        }\r\n        if(pos.y > this.size.height - 10)\r\n        {\r\n            //remove previous\r\n            if(this.pre_prev)\r\n            {\r\n                this.nodepool.put(this.pre_prev);\r\n                // console.log(\"InfiniteBackground : recycle background:\" ,this.nodepool.size())\r\n            }\r\n        }\r\n        //todo remove \r\n    }\r\n}\r\n"]}