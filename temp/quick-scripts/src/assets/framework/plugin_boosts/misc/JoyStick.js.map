{"version":3,"sources":["assets\\framework\\plugin_boosts\\misc\\JoyStick.ts"],"names":[],"mappings":";;;;;AAAM,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAsC,4BAAY;IAAlD;QAAA,qEAmHC;QAhHG,kBAAY,GAAW,IAAI,CAAC;QAG5B,iBAAW,GAAW,IAAI,CAAC;QAG3B,YAAM,GAAU,GAAG,CAAC;QAGpB,uBAAiB,GAAW,EAAE,CAAC;QAE/B,cAAc;QAEd,sBAAgB,GAAW,KAAK,CAAC;QAEjC,mBAAmB;QAEnB,qBAAe,GAAW,KAAK,CAAC;QAGhC,gBAAU,GAAW,KAAK,CAAC;QAE3B,gBAAU,GAAG,KAAK,CAAC;QAwDnB,eAAS,GAAW,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC;;IAkCrC,CAAC;IAzFG,yBAAM,GAAN;QAEI,IAAG,IAAI,CAAC,UAAU,EAClB;YACI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC,MAAM,GAAC,CAAC,CAAC;SAC7D;QACD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IAC7B,CAAC;IAED,wBAAK,GAAL;QAEI,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IAED,+BAAY,GAAZ;QAEI,IAAI,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,EAAG,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzC,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,kBAAkB,EAAE,CAAC,CAAC;QAClD,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QACnC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAEvB,IAAG,IAAI,CAAC,eAAe,EACvB;YACI,IAAI,CAAC,YAAY,CAAE,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAA;SACzC;IACL,CAAC;IAED,6BAAU,GAAV;QAEI,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IAC7B,CAAC;IAED,sBAAI,0BAAI;aAAR;YAEI,IAAG,IAAI,CAAC,UAAU;gBAAE,OAAO,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC;YACxC,IAAI,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC;YACzC,GAAG,CAAC,aAAa,EAAE,CAAA;YACnB,OAAO,GAAG,CAAC;QACf,CAAC;;;OAAA;IAED,uBAAI,GAAJ,UAAK,GAAW;QAEZ,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,EAAE,CAAC;QACpB,IAAG,GAAG,GAAG,IAAI,CAAC,MAAM,EACpB;YACI,IAAG,IAAI,CAAC,gBAAgB;gBACpB,IAAI,CAAC,YAAY,EAAE,CAAC;YAExB,GAAG,CAAC,aAAa,EAAE,CAAC;YACpB,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SAC3B;QACD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IACtC,CAAC;IAID,sBAAsB;IACtB,6BAAU,GAAV,UAAW,CAAC;QAER,IAAG,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO;QACzB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACjC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACxB,IAAG,IAAI,CAAC,eAAe,EACvB;YACI,2BAA2B;YAC3B,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC;YACxD,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAC3B,yBAAyB;YACzB,uCAAuC;SAC1C;QACD,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5B,CAAC;IAED,4BAAS,GAAT,UAAU,CAAC;QAEP,IAAG,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO;QACzB,IAAI,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAChC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACnB,CAAC;IAED,2BAAQ,GAAR,UAAS,CAAC;QAEN,IAAG,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO;QACzB,gBAAgB;QAChB,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IA/GD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;kDACU;IAG5B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;iDACS;IAG3B;QADC,QAAQ;4CACW;IAGpB;QADC,QAAQ;uDACsB;IAI/B;QADC,QAAQ;sDACwB;IAIjC;QADC,QAAQ;qDACuB;IAGhC;QADC,QAAQ;gDACkB;IAvBV,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAmH5B;IAAD,eAAC;CAnHD,AAmHC,CAnHqC,EAAE,CAAC,SAAS,GAmHjD;kBAnHoB,QAAQ","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class JoyStick extends cc.Component\r\n{\r\n    @property(cc.Node)\r\n    outterCircle:cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    innerCircle:cc.Node = null;\r\n\r\n    @property\r\n    radius:number = 250;\r\n\r\n    @property\r\n    innerCircleRadius:number =  20;\r\n\r\n    // 超出是否relase \r\n    @property\r\n    releaseAfterOver:boolean = false;\r\n\r\n    // dynamic Joystick\r\n    @property\r\n    dynamicJoystick:boolean = false;\r\n\r\n    @property\r\n    autoRadius:boolean = false;\r\n\r\n    isReleased = false;\r\n    onLoad()\r\n    {\r\n        if(this.autoRadius)\r\n        {\r\n            this.radius = this.outterCircle.getBoundingBox().height/2;\r\n        }\r\n        this.innerCircle.setPosition(0,0);\r\n        this.node.active = false;\r\n    }\r\n\r\n    start()\r\n    {\r\n        this.releaseStick();\r\n    }\r\n    \r\n    releaseStick()\r\n    {\r\n        let move = cc.moveTo(0.5 , cc.Vec2.ZERO);\r\n        let action = move.easing(cc.easeExponentialOut());\r\n        this.innerCircle.runAction(action);\r\n        this.isReleased = true;\r\n        \r\n        if(this.dynamicJoystick)\r\n        {\r\n            this.scheduleOnce( this.delayClose, 1)\r\n        }\r\n    }\r\n\r\n    delayClose()\r\n    {\r\n        this.node.active = false;\r\n    }\r\n\r\n    get axis()\r\n    {\r\n        if(this.isReleased) return cc.Vec2.ZERO;\r\n        let vec = this.innerCircle.getPosition();\r\n        vec.normalizeSelf()\r\n        return vec;\r\n    }\r\n\r\n    move(pos:cc.Vec2)\r\n    {\r\n        let mag = pos.mag();\r\n        if(mag > this.radius)\r\n        {\r\n            if(this.releaseAfterOver)\r\n                this.releaseStick();\r\n            \r\n            pos.normalizeSelf();\r\n            pos.mulSelf(this.radius)\r\n        }\r\n        this.innerCircle.setPosition(pos);\r\n    }\r\n\r\n    _startPos:cc.Vec2 = cc.Vec2.ZERO;\r\n\r\n    // p : screen position\r\n    touchStart(p)\r\n    {\r\n        if(!this.enabled) return;\r\n        this.isReleased = false;\r\n        this._startPos = p;\r\n        this.unschedule(this.delayClose);\r\n        this.node.active = true;\r\n        if(this.dynamicJoystick)\r\n        {\r\n            // converto screen position\r\n            let pos = this.node.getParent().convertToNodeSpaceAR(p);\r\n            this.node.setPosition(pos);\r\n            // this.node.opacity = 0;\r\n            // this.node.runAction(cc.fadeIn(0.5));\r\n        }\r\n        this.move(cc.Vec2.ZERO);\r\n    }\r\n\r\n    touchMove(p)\r\n    {\r\n        if(!this.enabled) return;\r\n        let vec = p.sub(this._startPos);\r\n        this.move(vec);\r\n    }\r\n\r\n    touchEnd(p)\r\n    {\r\n        if(!this.enabled) return;\r\n        // this.move(p);\r\n        this.releaseStick();\r\n    }\r\n}"]}