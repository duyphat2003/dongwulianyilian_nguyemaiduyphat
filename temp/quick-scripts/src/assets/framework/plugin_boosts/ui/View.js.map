{"version":3,"sources":["assets\\framework\\plugin_boosts\\ui\\View.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIComponent from \"./UIComponent\";\r\nimport ViewManager from \"./ViewManager\";\r\nimport { event } from \"../utils/EventManager\";\r\nimport UIFunctions from \"./UIFunctions\";\r\nimport { Toast } from \"./ToastManager\";\r\nimport LanguageManager, { LanguageMode } from \"../../../Game/Scripts/LanguageManager\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class View extends UIComponent {\r\n    // isTouchEnabled: boolean = true;\r\n    emit(event,msg)\r\n    {\r\n        event.emit(msg)\r\n      // this.node.emit(msg);  \r\n    }\r\n\r\n    name:string;\r\n    @property\r\n    isDialog:boolean = false;\r\n\r\n    @property\r\n    hasWidget:boolean = false;\r\n\r\n    target:any;\r\n\r\n    @property\r\n    opacity:number = 160;\r\n\r\n    @property\r\n    childrenAnimation:boolean = false;\r\n\r\n\r\n    touchBlocker:cc.Node = null;\r\n    touchBlockerComp: cc.BlockInputEvents = null;\r\n\r\n    @property(cc.Label)\r\n    guideLabel: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    startLabel: cc.Label = null;\r\n\r\n    @property({ type: cc.Integer })\r\n    ch_FontSize: number = 25;\r\n    @property({ type: cc.Integer })\r\n    vi_FontSize: number = 16;\r\n    @property({ type: cc.Integer })\r\n    eng_FontSize: number = 20;\r\n\r\n    onEnable() {\r\n        if (this.guideLabel == null || this.startLabel == null) {\r\n            return;\r\n        }\r\n        switch (LanguageManager.instance.currentLanguage) {\r\n            case LanguageMode.CN:\r\n                this.set_label_lang(\"连接相同的2个动物\",\r\n                    \"点击任意处关闭\",\r\n                );\r\n                this.set_label_FontSize(this.ch_FontSize);\r\n\r\n                break;\r\n            case LanguageMode.VI:\r\n                this.set_label_lang(\"Nối hai con vật giống hệt nhau.\",\r\n                    \"Nhấp vào bất kỳ đâu để đóng.\",                );\r\n                this.set_label_FontSize(this.vi_FontSize);\r\n\r\n                break;\r\n            case LanguageMode.EN:\r\n                this.set_label_lang(\"Connect two identical animals.\",\r\n                    \"Click anywhere to close.\",                );\r\n                this.set_label_FontSize(this.eng_FontSize);\r\n\r\n                break;\r\n        }\r\n    }\r\n\r\n    set_label_lang(\r\n        guideLabelString: string,\r\n        startLabelString: string,\r\n    ) {\r\n        this.guideLabel.string = guideLabelString;\r\n        this.startLabel.string = startLabelString;\r\n    }\r\n\r\n    set_label_FontSize(fontSize: number) {\r\n        this.guideLabel.fontSize = fontSize;\r\n        this.startLabel.fontSize = fontSize;\r\n    }\r\n\r\n    // @property\r\n    // showAnimationName:string = \"\";\r\n    // @property\r\n    // hideAnimationName:string = \"\";\r\n\r\n    // @property([cc.Component.EventHandler])\r\n    // onShownEvents:cc.Component.EventHandler[] = [];\r\n\r\n    // @property([cc.Component.EventHandler])\r\n    // onHiddenEvents:cc.Component.EventHandler[] = [];\r\n\r\n    animations:cc.Animation[] = [];\r\n\r\n    call(event,exp:string)\r\n    {\r\n        // eval(exp);\r\n        g.execScript(exp);\r\n    }\r\n\r\n    setDelegate(target)\r\n    {\r\n        this.target = target;\r\n    }\r\n\r\n    onLoad()\r\n    {\r\n\r\n        this.touchBlocker = new cc.Node();\r\n        this.touchBlocker.name = \"TouchBlocker\"\r\n        this.touchBlocker.width = 2000;\r\n        this.touchBlocker.height = 2000;\r\n        this.touchBlockerComp = this.touchBlocker.addComponent(cc.BlockInputEvents)\r\n        this.node.addChild(this.touchBlocker,1000)\r\n        \r\n        if(this.childrenAnimation)\r\n        {\r\n            this.animations = UIFunctions.getChildrenAnimations(this.node)\r\n        }else{\r\n            var anim = this.node.getComponent(cc.Animation)\r\n            if(anim)\r\n                this.animations.push(anim)\r\n        }\r\n        let components = this.getComponents(cc.Component);\r\n        for(var i = 0; i < components.length;i++)\r\n        {\r\n            let comp:any = components[i]\r\n            if(comp != this)\r\n            {\r\n                if(comp.onShown||comp.onHidden)\r\n                {\r\n                    this.target = comp;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    start()\r\n    {\r\n        this.touchEnabled = true;\r\n    }\r\n\r\n    init(viewname)\r\n    {\r\n        this.name = viewname;\r\n    }\r\n\r\n    hideAnimationCallback()\r\n    {\r\n        this.node.active = this.visible;\r\n        ViewManager.instance.checkViewStacks();\r\n    }\r\n\r\n    _isHiding:boolean = false;\r\n\r\n    /**\r\n     * //如果 实现了view的animation那么需要 animation 去做隐藏\r\n     * 否则会不会有animtion ，系统 将直接 设置 active 为false\r\n     */\r\n    doHideAnimation()\r\n    {\r\n        // if (!this.isDialog)\r\n        // {\r\n        //todo is in hide animtion return ;\r\n        // if(this.isInHideAnimation())return;\r\n        this.node.active = true;\r\n        this._isHiding = true;\r\n        if(!UIFunctions.doHideAnimations(this.animations,this.hideAnimationCallback,this))\r\n        {\r\n            this.node.active = false;\r\n            this._isHiding = false;\r\n        }\r\n        console.log(\"[View] hide:\",this.name);\r\n        this._visibleDirty = false;\r\n    }\r\n\r\n    isInHideAnimation(): any {\r\n        return this._isHiding\r\n    }\r\n    \r\n    onHidden()\r\n    {\r\n        this._visibleDirty = false;\r\n        if (this.target && this.target.onHidden)\r\n            this.target.onHidden();\r\n        // cc.Component.EventHandler.emitEvents(this.onHiddenEvents,[params]);\r\n    }\r\n\r\n    hide(){\r\n        // super.hide()\r\n        //ViewManager remove dd\r\n        this.touchEnabled = false;\r\n        ViewManager.instance.hide(this.node);\r\n    }\r\n\r\n    _visibleDirty:boolean;\r\n    \r\n    get visible(){return this._visibleDirty;}\r\n\r\n\r\n    showAnimationNextFrame(callback)\r\n    {\r\n        this.scheduleOnce(_=>{\r\n            UIFunctions.doShowAnimations(this.animations,callback)\r\n        },0)\r\n    }\r\n\r\n    get touchEnabled()\r\n    {\r\n        return !this.touchBlocker.active\r\n    }\r\n\r\n    set touchEnabled(b)\r\n    {\r\n        this.touchBlocker.active  = !b\r\n    }\r\n\r\n    // setTouchEnabled(bEnabled){\r\n    //     this.touchBlockerComp.enabled = bEnabled;\r\n    //     // UIFunctions.setTouchEnabled(this.node,bEnabled);\r\n    // }\r\n\r\n    show(...params)\r\n    {\r\n        super.show();\r\n        console.log(\"[View] show:\",this.name , params);\r\n        UIFunctions.stopAnimations(this.animations);\r\n       \r\n        // call next frames \r\n        // this.showAnimationDelay()\r\n        //确保在widget 更新结束后开始动画 ，\r\n        return new Promise<void>((resolve,reject)=>{\r\n            let self = this;\r\n            \r\n            let showFinishCallback = function() \r\n            {\r\n                if(!self.touchEnabled)\r\n                    self.touchEnabled = true;\r\n                resolve();\r\n            }\r\n            if(!this.hasWidget)\r\n            {\r\n                UIFunctions.doShowAnimations(this.animations,showFinishCallback)\r\n            }else{\r\n                this.showAnimationNextFrame(showFinishCallback)\r\n            }\r\n            this._visibleDirty = true;\r\n\r\n            // Add this block\r\n            let comp = this.node.getComponent(this.node.name);\r\n            if (comp && comp.init) {\r\n                comp.init(params[0]);  // call init with first param\r\n            }\r\n\r\n            if (this.target && this.target.onShown)\r\n            {\r\n                this.target.onShown(...params);\r\n            }\r\n            // cc.Component.EventHandler.emitEvents(this.onShownEvents,[params]);\r\n        })\r\n    }\r\n}\r\n"]}