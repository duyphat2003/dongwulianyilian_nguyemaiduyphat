{"version":3,"sources":["assets\\Game\\Scripts\\ui\\ShopDialog.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ShopItemTemplate from \"./ShopItemTemplate\";\r\nimport SpriteFrameCache from \"../../../framework/plugin_boosts/misc/SpriteFrameCache\";\r\nimport { R } from \"../hex-lines-game/Res\";\r\nimport Platform from \"../../../framework/Platform\";\r\nimport { UserInfo, ChoiceType } from \"../Info\";\r\nimport { Toast } from \"../../../framework/plugin_boosts/ui/ToastManager\";\r\nimport UIFunctions from \"../../../framework/plugin_boosts/ui/UIFunctions\";\r\nimport Device from \"../../../framework/plugin_boosts/gamesys/Device\";\r\nimport Main from \"../Main\";\r\nimport LanguageManager, { LanguageMode } from \"../LanguageManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ShopDialog extends cc.Component {\r\n\r\n    @property(cc.ScrollView)\r\n    scrollView: cc.ScrollView = null;\r\n\r\n    @property(cc.Label)\r\n    freeDiamondLabel: cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    freeDiamondBtn: cc.Button = null;\r\n\r\n    onLoad() {\r\n        // this.scrollview\r\n    }\r\n\r\n\r\n    onShown() {\r\n        // {\"id\":\"1\",\"mini_img\":\"a1\",\"img\":\"a2\",\"cost\":\"100\"},\r\n        this.scrollview.showlist((node: cc.Node, data: any, i: number) => {\r\n            // console.log(i,data);\r\n            let item = node.getComponent(ShopItemTemplate);\r\n            item.data = data;\r\n            item.diamondLabel.string = data.cost;\r\n            let isLocked = !UserInfo.isUnlock(data.id);\r\n            item.btnBuyNode.active = isLocked\r\n            item.maskNode.active = isLocked;\r\n            item.borderNode.color = cc.Color.WHITE;\r\n            item.titleLabel.string = data.text;\r\n            item.selectedFlag.active = UserInfo.selectedSkin == data.id;\r\n            item.btnSignal.add(this.click_unlock, this)\r\n            SpriteFrameCache.instance.getSpriteFrame(\"Game/Textures/ThumbBgs/\" + data.mini_img + \".jpg\").then(sf => item.bgmini.spriteFrame = sf)\r\n        }, R.skinConfig.json)\r\n\r\n        this.refreshBtnStatus();\r\n    }\r\n\r\n    refreshBtnStatus() {\r\n        if (g.isNextDay(UserInfo.shopFreeDiamondTime)) {\r\n            this.freeDiamondLabel.string = \"免费得50\"\r\n            UIFunctions.setButtonEnabled(this.freeDiamondBtn, true)\r\n        } else {\r\n            this.freeDiamondLabel.string = \"已领取\"\r\n            UIFunctions.setButtonEnabled(this.freeDiamondBtn, false)\r\n        }\r\n    }\r\n\r\n    click_close() {\r\n\r\n    }\r\n\r\n    share_succ() {\r\n        UserInfo.addDiamond(50);\r\n        UserInfo.shopFreeDiamondTime = new Date().getTime();\r\n        UserInfo.save()\r\n        this.refreshBtnStatus();\r\n    }\r\n\r\n    click_free() {\r\n        let choice = UserInfo.getChoice(ChoiceType.Shop)\r\n        if (choice == 1) {\r\n            Platform.share(this.share_succ, this)\r\n        } else if (choice == 0) {\r\n            this.share_succ()\r\n        } else {\r\n            //video\r\n            Platform.watch_video(this.share_succ, this)\r\n        }\r\n    }\r\n\r\n    selectBg(data) {\r\n        UserInfo.selectedSkin = data.id;\r\n        UserInfo.save()\r\n        this.onShown();\r\n    }\r\n\r\n    click_unlock(data) {\r\n        if (UserInfo.isUnlock(data.id)) {\r\n            //select \r\n            this.selectBg(data);\r\n            Toast.make(\"已选择 \" + data.text)\r\n            return;\r\n        }\r\n        if (UserInfo.diamond >= data.cost) {\r\n            UserInfo.diamond -= data.cost;\r\n            UserInfo.unlock(data.id);\r\n            this.selectBg(data)\r\n            Toast.make(cc.js.formatStr(\"%s已解锁\", data.text))\r\n            Device.playEffect(R.audio_unlock)\r\n            if (Main.instance)\r\n                Main.instance.refreshRedpoints()\r\n        } else {\r\n            Toast.make(\"钻石不足\")\r\n            Device.playEffect(R.audio_invalid)\r\n        }\r\n    }\r\n\r\n}\r\n"]}