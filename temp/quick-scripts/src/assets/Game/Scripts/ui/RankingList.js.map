{"version":3,"sources":["assets\\Game\\Scripts\\ui\\RankingList.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UserInfo } from \"../Info\";\r\nimport RankItem from \"./RankItem\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RankingList extends cc.Component {\r\n\r\n    @property(cc.ScrollView)\r\n    scrollView: cc.ScrollView = null;\r\n\r\n    @property(cc.Prefab)\r\n    rankItemPrefab: cc.Prefab = null;\r\n\r\n    apiUrl: string = \"https://5d820f171c8ff70014ef438d.mockapi.io/1/ranking-list\";\r\n\r\n    start() {\r\n        this.loadRanking();\r\n        console.log(\"UserInfo Level : \" + UserInfo.level.toString());\r\n\r\n    }\r\n\r\n    loadRanking() {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", this.apiUrl, true);\r\n        xhr.onload = () => {\r\n            if (xhr.status >= 200 && xhr.status < 300) {\r\n                let data = JSON.parse(xhr.responseText); \r\n\r\n                // Sort ascending by level\r\n                data.sort((a, b) => a.level - b.level);\r\n\r\n\r\n                // Add you when you in top 10\r\n                for (let i = 0; i < data.length; i++) {\r\n                    const item = data[i];\r\n                    console.error(item.name + \" : \" + item.level.toString());\r\n                    if (item.level <= UserInfo.level) {\r\n                        if (i === 0) {\r\n                            item.level = UserInfo.level;\r\n                            item.name = \"YOU\";\r\n                        } else {\r\n                            const tempName = \"YOU\";\r\n                            const tempLevel = UserInfo.level;\r\n\r\n                            data[i - 1].name = item.name;\r\n                            data[i - 1].level = item.level;\r\n\r\n                            item.name = tempName;\r\n                            item.level = tempLevel;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Sort descending by level\r\n                data.sort((a, b) => b.level - a.level);\r\n                this.populateScrollView(data);\r\n            } else {\r\n                console.error(\"XHR failed:\", xhr.status);\r\n            }\r\n        };\r\n        xhr.onerror = () => console.error(\"XHR request error\");\r\n        xhr.send();\r\n    }\r\n\r\n    populateScrollView(rankingData: any[]) {\r\n\r\n\r\n        const content = this.scrollView.content;\r\n        content.removeAllChildren();\r\n\r\n        if (UserInfo.getData)\r\n\r\n            rankingData.forEach((item, index) => {\r\n            const node = cc.instantiate(this.rankItemPrefab);\r\n            const rankItemComp = node.getComponent(RankItem);\r\n                if (item.name === \"YOU\") {\r\n                    rankItemComp.rankLabel.node.color = cc.Color.YELLOW;\r\n                    rankItemComp.levelLabel.node.color = cc.Color.YELLOW;\r\n                    rankItemComp.nameLabel.node.color = cc.Color.YELLOW;\r\n\r\n            }\r\n            rankItemComp.init(index + 1, item.level, item.name);\r\n            content.addChild(node);\r\n        });\r\n\r\n        const itemHeight = this.rankItemPrefab.data.height;\r\n        content.height = rankingData.length * itemHeight;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n"]}